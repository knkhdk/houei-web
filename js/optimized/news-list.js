document.addEventListener('DOMContentLoaded',function(){console.log('news-list.js loaded');loadNewsList();setupFilterButtons();});function loadNewsList(){try{console.log('お知らせ一覧を読み込み中...');const localData=localStorage.getItem('newsData');const newsData=localData ? JSON.parse(localData) : [];console.log('取得したお知らせデータ:',newsData);const newsTimeline=document.getElementById('newsTimeline');if (!newsTimeline){console.error('newsTimeline要素が見つかりません');return;}if (newsData.length===0){newsTimeline.innerHTML=` <div class="no-news-message"> <h3>お知らせがありません</h3> <p>現在、お知らせはありません。新しいお知らせが投稿されると、ここに表示されます。</p> </div> `;return;}const sortedNewsData=newsData .filter(news=> news.status==='published') .sort((a,b)=>{const dateA=new Date(a.date);const dateB=new Date(b.date);return dateB-dateA;});console.log('ソート済みお知らせデータ:',sortedNewsData);const newsItemsHtml=sortedNewsData .map(news=> generateNewsItemHtml(news)) .join('');newsTimeline.innerHTML=newsItemsHtml;console.log('お知らせ一覧の表示が完了しました');}catch (error){console.error('お知らせ一覧の読み込みに失敗しました:',error);const newsTimeline=document.getElementById('newsTimeline');if (newsTimeline){newsTimeline.innerHTML=` <div class="error-message"> <h3>エラーが発生しました</h3> <p>お知らせの読み込みに失敗しました。ページを再読み込みしてください。</p> </div> `;}}}function generateNewsItemHtml(news){const dateObj=new Date(news.date);const day=dateObj.getDate();const month=dateObj.getMonth()+1;const year=dateObj.getFullYear();let detailsHTML='';if (news.details){Object.values(news.details).forEach(detail=>{if (detail.label && detail.value){detailsHTML+=`<p><strong>${detail.label}:</strong> ${detail.value}</p>`;}});}let imageHTML='';if (news.image){imageHTML=` <div class="timeline-image"> <img src="${news.image}" alt="${news.title}" onerror="this.style.display='none'"> </div> `;}return ` <div class="timeline-item" data-category="${news.category}"> <div class="timeline-date"> <span class="timeline-day">${day}</span> <span class="timeline-month">${year}.${month.toString().padStart(2,'0')}</span> </div> <div class="timeline-content"> <span class="timeline-category">${news.category}</span> <h3>${news.title}</h3> <p>${news.summary}</p> <p>${news.content}</p> ${imageHTML}${detailsHTML ? `<div class="timeline-details">${detailsHTML}</div>` : ''}<div class="timeline-link"> <a href="detail.html?id=${news.id}" class="btn btn-primary">詳細を見る</a> </div> </div> </div> `;}function setupFilterButtons(){const filterButtons=document.querySelectorAll('.filter-btn');filterButtons.forEach(button=>{button.addEventListener('click',function(){const category=this.getAttribute('data-category');filterButtons.forEach(btn=> btn.classList.remove('active'));this.classList.add('active');filterNewsByCategory(category);});});}function filterNewsByCategory(category){const timelineItems=document.querySelectorAll('.timeline-item');timelineItems.forEach(item=>{const itemCategory=item.getAttribute('data-category');if (category==='all' || itemCategory===category){item.style.display='flex';}else{item.style.display='none';}});const visibleItems=document.querySelectorAll('.timeline-item[style="display: flex;"]');const noResultsMessage=document.querySelector('.no-results-message');if (visibleItems.length===0){if (!noResultsMessage){const newsTimeline=document.getElementById('newsTimeline');const message=document.createElement('div');message.className='no-results-message';message.innerHTML=` <h3>該当するお知らせがありません</h3> <p>選択されたカテゴリには、お知らせがありません。</p> `;newsTimeline.appendChild(message);}}else{if (noResultsMessage){noResultsMessage.remove();}}}window.addEventListener('storage',function(e){if (e.key==='newsData'){console.log('newsDataが更新されました。お知らせ一覧を再読み込みします。');loadNewsList();}});window.addEventListener('newsUpdated',function(e){console.log('newsUpdatedイベントを受信しました。お知らせ一覧を再読み込みします。');loadNewsList();});